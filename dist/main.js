!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=7)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"texture",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#000000",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5,i=document.getElementById(t),r=i.getContext("2d");r.globalAlpha=1,r.fillStyle=e,r.fillRect(0,0,i.width,i.height),r.globalAlpha=n;for(var a=0;a<i.width*i.height;a++){var o=64*Math.random()<<32;r.fillStyle="rgb("+(o+128)+","+(o+128)+","+(o+128)+")",r.fillRect(a%i.width,Math.floor(a/i.width),1,1)}return i}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=function(){function t(e,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ctx=e.getContext("2d"),this.width=e.width=.5*window.innerWidth,this.height=e.height=.5*window.innerHeight,this.resolution=n,this.spacing=this.width/n,this.focalLength=i||.8,this.range=14,this.lightRange=8,this.scale=(this.width+this.height)/1200}return i(t,[{key:"render",value:function(t,e){this.drawColumns(t,e)}},{key:"drawColumns",value:function(t,e){this.ctx.save();for(var n=0;n<this.resolution;n++){var i=n/this.resolution-.5,r=Math.atan2(i,this.focalLength),a=e.cast(t,t.direction+r,this.range);this.drawColumn(n,a,r,e)}this.ctx.restore()}},{key:"drawColumn",value:function(t,e,n,i){for(var r=this.ctx,a=i.wallTexture,o=Math.floor(t*this.spacing),u=Math.ceil(this.spacing),s=-1;++s<e.length&&e[s].height<=0;);for(var l=e.length-1;l>=0;l--){var h=e[l];if(l===s){var c=Math.floor(a.width*h.offset),f=this.project(h.height,n,h.distance);r.globalAlpha=1,r.fillRect(o,f.top,u,f.height),r.drawImage(a,c,0,1,a.height,o,f.top,u,f.height),r.fillStyle="#000000",r.globalAlpha=Math.max((h.distance+h.shading)/this.lightRange,0),r.fillRect(o,f.top-1,u,f.height+2)}}}},{key:"project",value:function(t,e,n){var i=n*Math.cos(e),r=this.height*t/i;return{top:this.height/2*(1+1/i)-r,height:r}}}]),t}();e.default=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.size=e,this.wallGrid=new Uint8Array(e*e),this.wallTexture=n}return i(t,[{key:"get",value:function(t,e){return t=Math.floor(t),e=Math.floor(e),t<0||t>this.size-1||e<0||e>this.size-1?-1:this.wallGrid[e*this.size+t]}},{key:"randomize",value:function(){for(var t=0;t<this.size*this.size;t++)this.wallGrid[t]=Math.random()<.3?1:0}},{key:"cast",value:function(t,e,n){var i=this,r=Math.sin(e),a=Math.cos(e),o={length2:1/0};return function t(e){var i=u(r,a,e.x,e.y);var o=u(a,r,e.y,e.x,!0);var l=i.length2<o.length2?s(i,1,0,e.distance,i.y):s(o,0,1,e.distance,o.x);if(l.distance>n)return[e];return[e].concat(t(l))}({x:t.x,y:t.y,height:0,distance:0});function u(t,e,n,i,r){if(0===e)return o;var a=e>0?Math.floor(n+1)-n:Math.ceil(n-1)-n,u=a*(t/e);return{x:r?i+u:n+a,y:r?n+a:i+u,length2:a*a+u*u}}function s(t,e,n,o,u){var s=a<0?e:0,l=r<0?n:0;return t.height=i.get(t.x-s,t.y-l),t.distance=o+Math.sqrt(t.length2),t.shading=e>0?a<0?2:0:r<0?2:1,t.offset=u-Math.floor(u),t}}},{key:"update",value:function(t){}}]),t}();e.default=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=2*Math.PI,a=function(){function t(e,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=e,this.y=n,this.direction=i,this.speed=5}return i(t,[{key:"rotate",value:function(t){this.direction=(this.direction+t+r)%r}},{key:"walk",value:function(t,e){var n=Math.cos(this.direction)*t,i=Math.sin(this.direction)*t;e.get(this.x+2*n,this.y)<=0&&(this.x+=n),e.get(this.x,this.y+2*i)<=0&&(this.y+=i)}},{key:"update",value:function(t,e,n){t.left&&this.rotate(-Math.PI*n),t.right&&this.rotate(Math.PI*n),t.forward&&this.walk(this.speed*n,e),t.backward&&this.walk(-this.speed*n,e)}}]),t}();e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.frame=this.frame.bind(this),this.lastTime=0,this.callback=function(){}}return i(t,[{key:"start",value:function(t){this.callback=t||this.callback,requestAnimationFrame(this.frame)}},{key:"frame",value:function(t){var e=(t-this.lastTime)/1e3;this.lastTime=t,e<.2&&this.callback(e),requestAnimationFrame(this.frame)}}]),t}();e.default=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.codes={37:"left",39:"right",38:"forward",40:"backward"},this.states={left:!1,right:!1,forward:!1,backward:!1},document.addEventListener("keydown",this.onKey.bind(this,!0),!1),document.addEventListener("keyup",this.onKey.bind(this,!1),!1)}return i(t,[{key:"onKey",value:function(t,e){var n=this.codes[e.keyCode];void 0!==n&&(this.states[n]=t,e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation())}}]),t}();e.default=r},function(t,e,n){"use strict";var i=l(n(5)),r=l(n(4)),a=l(n(3)),o=l(n(2)),u=l(n(1)),s=l(n(0));function l(t){return t&&t.__esModule?t:{default:t}}var h=document.getElementById("test-canvas"),c=new a.default(1500.2,1500.2,.3*Math.PI),f=new o.default(3200,(0,s.default)("texture","#ddaa00")),d=new u.default(h,320,.8),v=new i.default,g=new r.default;f.randomize();g.start(function(t){h.getContext("2d").clearRect(0,0,h.width,h.height),f.update(t),c.update(v.states,f,t),d.render(c,f)})},function(t,e,n){t.exports=n(6)}]);